(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[332],{2898:(e,t,n)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return n(9843)}])},9843:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>c});var o=n(7876),r=n(4232);let a="ws://localhost:8080";function c(){let e=(0,r.useRef)(null),t=(0,r.useRef)(null),[n,c]=(0,r.useState)(!1),[i,s]=(0,r.useState)(null),[l,u]=(0,r.useState)(""),[d,g]=(0,r.useState)("Enter a game code to join or create one!");(0,r.useEffect)(()=>{if(l)return t.current&&t.current.close(),t.current=new WebSocket(a),t.current.onopen=()=>{console.log("Connected to WebSocket backend!"),g("Connected! Sending join request..."),t.current.send(JSON.stringify({type:"joinGame",gameCode:l}))},t.current.onmessage=e=>{let t=JSON.parse(e.data);console.log("Received from backend:",t),"initialGameState"===t.type&&t.gameRoom?(g("Joined game: ".concat(t.gameRoom.gameCode,". Waiting for turn.")),t.gameRoom.canvasSegments&&t.gameRoom.canvasSegments.length>0&&s(t.gameRoom.canvasSegments[t.gameRoom.canvasSegments.length-1])):"canvasUpdate"===t.type&&t.gameRoomId===l?(s(t.canvasData),g("Drawing updated by another player!")):"error"===t.type&&g("Error: ".concat(t.message))},t.current.onclose=()=>{console.log("Disconnected from WebSocket backend."),g("Disconnected from game. Attempting to reconnect..."),setTimeout(()=>{l&&(t.current=new WebSocket(a))},3e3)},t.current.onerror=e=>{console.error("WebSocket error:",e),g("WebSocket connection error!")},()=>{var e;null==(e=t.current)||e.close()}},[l]),(0,r.useEffect)(()=>{let t=e.current;if(!t)return;let n=t.getContext("2d");if(n)if(n.clearRect(0,0,t.width,t.height),i){let e=new Image;e.onload=()=>{n.drawImage(e,0,0,t.width,t.height)},e.src=i}else n.clearRect(0,0,t.width,t.height)},[i]);let m=(0,r.useCallback)(t=>{let n,o,r=e.current;if(!r)return{x:0,y:0};let a=r.getBoundingClientRect();return t instanceof MouseEvent?(n=t.clientX,o=t.clientY):(n=t.touches[0].clientX,o=t.touches[0].clientY),{x:n-a.left,y:o-a.top}},[]),h=(0,r.useCallback)(t=>{let n=e.current;if(!n)return;let o=n.getContext("2d");if(!o)return;c(!0),o.beginPath();let{x:r,y:a}=m(t.nativeEvent);o.moveTo(r,a)},[m]),f=(0,r.useCallback)(t=>{if(!n)return;let o=e.current;if(!o)return;let r=o.getContext("2d");if(!r)return;let{x:a,y:c}=m(t.nativeEvent);r.lineTo(a,c),r.stroke()},[n,m]),p=(0,r.useCallback)(()=>{if(!n)return;c(!1);let o=e.current;if(!o)return;let r=o.toDataURL("image/png");t.current&&t.current.readyState===WebSocket.OPEN&&t.current.send(JSON.stringify({type:"drawUpdate",gameRoomId:l,canvasData:r,segmentIndex:0}))},[n,l]),v=async()=>{if(!l)return void g("Please enter a game code.");g("Attempting to join/create game: ".concat(l,"..."))};return(0,o.jsxs)("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",minHeight:"100vh",fontFamily:"sans-serif"},children:[(0,o.jsx)("h1",{children:"Exquisite Corpse"}),(0,o.jsx)("p",{children:d}),(0,o.jsxs)("div",{style:{marginBottom:"15px"},children:[(0,o.jsx)("input",{type:"text",placeholder:"Enter Game Code",value:l,onChange:e=>{u(e.target.value.toUpperCase())},maxLength:6,style:{padding:"8px",marginRight:"10px"}}),(0,o.jsx)("button",{onClick:v,style:{padding:"8px 15px"},children:"Join/Create Game"})]}),(0,o.jsx)("canvas",{ref:e,width:800,height:600,style:{border:"2px solid #333",borderRadius:"8px",backgroundColor:"white",touchAction:"none"},onMouseDown:h,onMouseMove:f,onMouseUp:p,onMouseLeave:p,onTouchStart:h,onTouchMove:f,onTouchEnd:p,onTouchCancel:p})]})}}},e=>{var t=t=>e(e.s=t);e.O(0,[636,593,792],()=>t(2898)),_N_E=e.O()}]);